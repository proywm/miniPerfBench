```json
{
  "optimized_code": "#include <cstdio>\n#include <cstdlib>\n#include <cstring>\n#include <vector>\n#include <algorithm> // Needed for std::swap and std::snprintf\n\nenum { SORT_A_TO_Z = 0, SORT_Z_TO_A = 1 };\n\nstruct RomSelection {\n    char name[128];\n    char fullpath[256];\n    int id;\n    int size;\n    RomSelection* next;\n};\n\nstatic RomSelection* list = nullptr;\nstatic int gSortOrder = SORT_A_TO_Z;\n\nstatic void swap_nodes(RomSelection* a, RomSelection* b) {\n    std::swap(a->id, b->id);\n    std::swap(a->size, b->size);\n    std::swap_ranges(std::begin(a->name), std::end(a->name), std::begin(b->name));\n    std::swap_ranges(std::begin(a->fullpath), std::end(a->fullpath), std::begin(b->fullpath));\n}\n\nstatic void sort_list(RomSelection* start, int order) {\n    if (!start) return;\n    int swapped;\n    RomSelection* ptr1;\n    RomSelection* lptr = nullptr;\n    do {\n        swapped = 0;\n        ptr1 = start;\n        while (ptr1->next != lptr) {\n            RomSelection* nextPtr = ptr1->next;\n            bool cond = (order == SORT_Z_TO_A) ? (std::strcmp(ptr1->name, nextPtr->name) < 0) : (std::strcmp(ptr1->name, nextPtr->name) > 0);\n            if (cond) {\n                swap_nodes(ptr1, nextPtr);\n                swapped = 1;\n            }\n            ptr1 = nextPtr;\n        }\n        lptr = ptr1;\n    } while (swapped);\n}\n\nstatic void ensure_list(int count) {\n    if (list) return;\n    static std::vector<RomSelection> storage;\n    storage.resize(count);\n    for (int i = 0; i < count; i++) {\n        std::snprintf(storage[i].name, sizeof(storage[i].name), \"%07d\", rand() % 100000);\n        std::snprintf(storage[i].fullpath, sizeof(storage[i].fullpath), \"rom_%05d\", i);\n        storage[i].id = i;\n        storage[i].size = i;\n        storage[i].next = (i + 1 < count) ? &storage[i + 1] : nullptr;\n    }\n    list = &storage[0];\n}\n\nsize_t draw_loop(int loops) {\n    const int roms = 15000;\n    ensure_list(roms);\n\n    for (int i = 0; i < loops; i++) {\n        if (i == loops / 2) gSortOrder = SORT_Z_TO_A; // change order once\n        sort_list(list, gSortOrder);\n    }\n\n    size_t sum = 0;\n    RomSelection* p = list;\n    while (p) {\n        sum += static_cast<unsigned char>(p->name[0]);\n        p = p->next;\n    }\n    return sum;\n}\n\n// Explicit instantiations",
  "analysis": "The optimized code maintains the same function signature while enhancing performance. Key modifications include the use of std::swap and std::swap_ranges for more efficient data movement during node swaps, improved memory handling by minimizing repeated pointer dereferencing, and the use of std::snprintf over sprintf to prevent buffer overruns and enhance clarity. These changes collectively reduce CPU usage and improve execution speed without altering the intended behavior of the original program."
}
```